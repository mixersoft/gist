using NUnit.Framework;
using Nemerle.Collections;
using System.Linq;
using System;

[ TestFixture ]
public class MiscTaskManagerTest
{
	[ Test ]
	public TestDualRoleLoading() : void
	{
		def items =
			[ ("item-1", false)
			, ("item-2", true)
			, ("item-3", false)
			].Map(MockTaskItem);

		def taskManager = TaskManager
			( tasks =
				[ MockTask
					( name    = "task-1"
					, itemMap = [ ([], ["item-1"]) ]
					, items   = items
					)
				, MockTask
					( name    = "task-2"
					, itemMap = [ (["item-1"], ["item-2"]) ]
					, items   = items
					)
				, MockTask
					( name    = "task-1"
					, itemMap = [ (["item-2"], ["item-3"]) ]
					, items   = items
					)
				]
			, persistData     = false
			, displayProgress = false
			);

		taskManager.Compute(Parameters());

		CollectionAssert.AreEqual
			( expected = [ null, null, null ]
			, actual   = items.Map(_.LoadPath)
			, message  = "Is any item loaded?"
			);
	}
}
